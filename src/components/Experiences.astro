---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import FormattedDate from "./FormattedDate.astro";

type Experience = CollectionEntry<"experience">;

const experiences: Experience[] = (await getCollection("experience")).sort(
  (a: Experience, b: Experience) => new Date(b.data.startDate).valueOf() - new Date(a.data.startDate).valueOf(),
);
---

<div class="experiences">
  <h2>Experience</h2>
  {
    experiences.map(async (experience: Experience) => {
      const { Content } = await experience.render();
      return (
        <section class="experience">
          <h3>
            <strong>{experience.data.company}</strong>, {experience.data.location} &mdash;
            <em>{experience.data.title}</em>
          </h3>
          <span class="period">
            <FormattedDate date={experience.data.startDate} /> &ndash;
            <FormattedDate date={experience.data.endDate} />
          </span>

          <Content />
        </section>
      );
    })
  }
</div>
